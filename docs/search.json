[
  {
    "objectID": "spei.html",
    "href": "spei.html",
    "title": "An√°lisis de Precipitaci√≥n y SPEI",
    "section": "",
    "text": "Cargamos las librer√≠as necesarias y definimos las rutas de los 6 archivos crudos (Precipitaci√≥n, T.M√°x y T.M√≠n para cada estaci√≥n).\n\n\nC√≥digo\n# Limpiar memoria\nrm(list = ls())\n\n# 1. Cargar paquetes\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(tidyverse, SPEI, lubridate, fs, here, purrr)\n\n# 2. Definir Rutas de Datos Crudos\n# Asumimos que los archivos est√°n en \"data/data_raw/\" con nombres simplificados\n# (Si usas los nombres largos originales, c√°mbialos aqu√≠)\n\n# Estaci√≥n Las Ramadas\nruta_ram_pp   &lt;- here::here(\"data\", \"data_raw\", \"ramadas_pmen.csv\")\nruta_ram_tmax &lt;- here::here(\"data\", \"data_raw\", \"ramadas_tmax.csv\")\nruta_ram_tmin &lt;- here::here(\"data\", \"data_raw\", \"ramadas_tmin.csv\")\n\n# Estaci√≥n Cogot√≠\nruta_cog_pp   &lt;- here::here(\"data\", \"data_raw\", \"cogoti_pmen.csv\")\nruta_cog_tmax &lt;- here::here(\"data\", \"data_raw\", \"cogoti_tmax.csv\")\nruta_cog_tmin &lt;- here::here(\"data\", \"data_raw\", \"cogoti_tmin.csv\")\n\n# Rutas de Salida\ndir_figuras   &lt;- here::here(\"figuras\")\ndir_data_proc &lt;- here::here(\"data\", \"data_procesada\")\n\n# 3. Verificaci√≥n r√°pida\narchivos_requeridos &lt;- c(ruta_ram_pp, ruta_ram_tmax, ruta_ram_tmin, \n                         ruta_cog_pp, ruta_cog_tmax, ruta_cog_tmin)\n\nexistencia &lt;- file.exists(archivos_requeridos)\nif (!all(existencia)) {\n  stop(\"ERROR: Faltan archivos en data/data_raw/. Verifica los nombres.\\nFaltan: \", \n       paste(archivos_requeridos[!existencia], collapse = \"\\n\"))\n}\n\n# Crear carpetas de salida\nif (!dir.exists(dir_figuras)) dir.create(dir_figuras, recursive = TRUE)\nif (!dir.exists(dir_data_proc)) dir.create(dir_data_proc, recursive = TRUE)\n\nmessage(\"Configuraci√≥n exitosa. Archivos crudos encontrados.\")"
  },
  {
    "objectID": "spei.html#configuraci√≥n-inicial",
    "href": "spei.html#configuraci√≥n-inicial",
    "title": "An√°lisis de Precipitaci√≥n y SPEI",
    "section": "",
    "text": "Cargamos las librer√≠as necesarias y definimos las rutas de los 6 archivos crudos (Precipitaci√≥n, T.M√°x y T.M√≠n para cada estaci√≥n).\n\n\nC√≥digo\n# Limpiar memoria\nrm(list = ls())\n\n# 1. Cargar paquetes\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(tidyverse, SPEI, lubridate, fs, here, purrr)\n\n# 2. Definir Rutas de Datos Crudos\n# Asumimos que los archivos est√°n en \"data/data_raw/\" con nombres simplificados\n# (Si usas los nombres largos originales, c√°mbialos aqu√≠)\n\n# Estaci√≥n Las Ramadas\nruta_ram_pp   &lt;- here::here(\"data\", \"data_raw\", \"ramadas_pmen.csv\")\nruta_ram_tmax &lt;- here::here(\"data\", \"data_raw\", \"ramadas_tmax.csv\")\nruta_ram_tmin &lt;- here::here(\"data\", \"data_raw\", \"ramadas_tmin.csv\")\n\n# Estaci√≥n Cogot√≠\nruta_cog_pp   &lt;- here::here(\"data\", \"data_raw\", \"cogoti_pmen.csv\")\nruta_cog_tmax &lt;- here::here(\"data\", \"data_raw\", \"cogoti_tmax.csv\")\nruta_cog_tmin &lt;- here::here(\"data\", \"data_raw\", \"cogoti_tmin.csv\")\n\n# Rutas de Salida\ndir_figuras   &lt;- here::here(\"figuras\")\ndir_data_proc &lt;- here::here(\"data\", \"data_procesada\")\n\n# 3. Verificaci√≥n r√°pida\narchivos_requeridos &lt;- c(ruta_ram_pp, ruta_ram_tmax, ruta_ram_tmin, \n                         ruta_cog_pp, ruta_cog_tmax, ruta_cog_tmin)\n\nexistencia &lt;- file.exists(archivos_requeridos)\nif (!all(existencia)) {\n  stop(\"ERROR: Faltan archivos en data/data_raw/. Verifica los nombres.\\nFaltan: \", \n       paste(archivos_requeridos[!existencia], collapse = \"\\n\"))\n}\n\n# Crear carpetas de salida\nif (!dir.exists(dir_figuras)) dir.create(dir_figuras, recursive = TRUE)\nif (!dir.exists(dir_data_proc)) dir.create(dir_data_proc, recursive = TRUE)\n\nmessage(\"Configuraci√≥n exitosa. Archivos crudos encontrados.\")"
  },
  {
    "objectID": "spei.html#procesamiento-de-datos",
    "href": "spei.html#procesamiento-de-datos",
    "title": "An√°lisis de Precipitaci√≥n y SPEI",
    "section": "2. Procesamiento de datos",
    "text": "2. Procesamiento de datos\nEn esta etapa leemos los archivos individuales de temperatura y precipitaci√≥n, los unimos por a√±o y mes, y calculamos el balance h√≠drico.\n\n\nC√≥digo\n# Funci√≥n auxiliar para leer y preparar cada archivo\n# Lee el CSV, selecciona solo a√±o/mes/valor y renombra la columna valor\nleer_variable &lt;- function(ruta, nombre_var) {\n  read_csv(ruta, show_col_types = FALSE) %&gt;%\n    select(agno, mes, valor) %&gt;%\n    rename(!!nombre_var := valor) # Renombra 'valor' a 'pmen', 'tmax' o 'tmin'\n}\n\n# --- PROCESAMIENTO LAS RAMADAS ---\nram_pp   &lt;- leer_variable(ruta_ram_pp, \"pmen\")\nram_tmax &lt;- leer_variable(ruta_ram_tmax, \"tmax\")\nram_tmin &lt;- leer_variable(ruta_ram_tmin, \"tmin\")\n\n# Unir las 3 variables (full_join para no perder meses si falta alg√∫n dato)\ndf_ramadas &lt;- list(ram_pp, ram_tmax, ram_tmin) %&gt;%\n  reduce(full_join, by = c(\"agno\", \"mes\")) %&gt;%\n  mutate(estacion = \"Las Ramadas\")\n\n# --- PROCESAMIENTO COGOT√ç ---\ncog_pp   &lt;- leer_variable(ruta_cog_pp, \"pmen\")\ncog_tmax &lt;- leer_variable(ruta_cog_tmax, \"tmax\")\ncog_tmin &lt;- leer_variable(ruta_cog_tmin, \"tmin\")\n\ndf_cogoti &lt;- list(cog_pp, cog_tmax, cog_tmin) %&gt;%\n  reduce(full_join, by = c(\"agno\", \"mes\")) %&gt;%\n  mutate(estacion = \"Cogot√≠\")\n\n# - --- UNIFICACI√ìN Y C√ÅLCULOS ---\ndatos &lt;- bind_rows(df_ramadas, df_cogoti) %&gt;%\n  mutate(fecha = make_date(agno, mes, 1)) %&gt;%\n  # --- CORRECCI√ìN CLAVE AQU√ç ---\n  # Eliminamos filas sin temperatura ANTES de calcular hargreaves\n  drop_na(tmax, tmin) %&gt;%\n  mutate(\n    # Ahora s√≠ podemos calcular ETP sin errores\n    etp = hargreaves(tmin, tmax, lat = -31.0358),\n    bal = pmen - etp\n  ) %&gt;%\n  # Limpiamos si falta precipitaci√≥n o balance final\n  drop_na(bal) %&gt;%\n  arrange(estacion, fecha)\n\n\n[1] \"Calculating reference evapotranspiration using the Hargreaves method. Using latitude (`lat`) to estimate extraterrestrial radiation. Checking for missing values (`NA`): all the data must be complete. Input type is vector. Assuming the data are monthly time series starting in January, all regular (non-leap) years.\"\n\n\nC√≥digo\n# Guardar CSV procesado completo\nwrite_csv(datos, path(dir_data_proc, \"datos_procesados_unificados.csv\"))\n\n# --- C√ÅLCULO DE SPEI ---\ndatos_spei &lt;- datos %&gt;%\n  group_by(estacion) %&gt;%\n  nest() %&gt;%\n  mutate(\n    spei_12 = map(data, ~ as.numeric(spei(.x$bal, 12)$fitted)),\n    spei_03 = map(data, ~ as.numeric(spei(.x$bal, 3)$fitted))\n  ) %&gt;%\n  unnest(cols = c(data, spei_12, spei_03)) %&gt;% \n  ungroup()\n\n\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 12. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 12. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 3. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 3. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n\n\nC√≥digo\n# Mostrar un resumen\nglimpse(datos_spei)\n\n\nRows: 1,165\nColumns: 11\n$ estacion &lt;chr&gt; \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"‚Ä¶\n$ agno     &lt;dbl&gt; 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1‚Ä¶\n$ mes      &lt;dbl&gt; 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, 7, 8, 9‚Ä¶\n$ pmen     &lt;dbl&gt; 0.0, 0.0, 2.0, 38.0, 2.4, 153.5, 161.5, 0.0, 0.0, 1.2, 0.0, 0‚Ä¶\n$ tmax     &lt;dbl&gt; 28.9, 25.9, 23.3, 21.4, 21.9, 17.0, 16.0, 19.4, 22.8, 24.6, 2‚Ä¶\n$ tmin     &lt;dbl&gt; 16.3, 13.7, 11.3, 8.4, 8.4, 5.8, 6.0, 6.9, 9.4, 11.3, 14.0, 1‚Ä¶\n$ fecha    &lt;date&gt; 1965-02-01, 1965-03-01, 1965-04-01, 1965-05-01, 1965-06-01, ‚Ä¶\n$ etp      &lt;dbl&gt; 169.68881, 168.07156, 152.84507, 122.46746, 119.65757, 73.512‚Ä¶\n$ bal      &lt;dbl&gt; -169.68881, -168.07156, -150.84507, -84.46746, -117.25757, 79‚Ä¶\n$ spei_12  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 1.3954235, 1.3959‚Ä¶\n$ spei_03  &lt;dbl&gt; NA, NA, -0.07306118, 0.24514050, -0.38907950, 0.88506499, 1.5‚Ä¶"
  },
  {
    "objectID": "spei.html#visualizaci√≥n-precipitaci√≥n-mensual",
    "href": "spei.html#visualizaci√≥n-precipitaci√≥n-mensual",
    "title": "An√°lisis de Precipitaci√≥n y SPEI",
    "section": "3. Visualizaci√≥n: Precipitaci√≥n Mensual",
    "text": "3. Visualizaci√≥n: Precipitaci√≥n Mensual\nAn√°lisis de la distribuci√≥n de lluvias para la estaci√≥n Las Ramadas.\n\n# Filtrar datos desde 1970 \ndf_box &lt;- datos_spei %&gt;% \n  filter(estacion == \"Las Ramadas\", year(fecha) &gt;= 1970 & year(fecha) &lt;= 2015)\n# Calcular colores\nmedianas &lt;- tapply(df_box$pmen, df_box$mes, median, na.rm=TRUE)\npaleta   &lt;- colorRampPalette(c(\"#E0F3DB\", \"#084081\"))(100)\ncolores  &lt;- paleta[findInterval(medianas, seq(min(medianas), max(medianas), length.out = 100))]\nmeses_esp &lt;- c(\"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\", \"Jul\", \"Ago\", \"Sep\", \"Oct\", \"Nov\", \"Dic\")\n\n# Funci√≥n de ploteo\nplot_boxplot &lt;- function() {\n  par(mar = c(4, 5, 3, 1))\n  boxplot(pmen ~ factor(mes, levels=1:12, labels = meses_esp), data = df_box,\n          col = colores, outline = FALSE, main = \"Pp Mensual Ramadas (1970-2015)\",\n          ylab = \"Pp (mm)\", las = 1, varwidth = TRUE)\n  grid(nx = NA, ny = NULL, lty = 3)\n  legend(\"topright\", legend=c(\"H√∫medo\",\"Seco\"), fill=c(paleta[100], paleta[1]), bty=\"n\", cex=0.8)\n}\n\nplot_boxplot()\n\n# Guardar PNG\npng(path(dir_figuras, \"boxplot_ramadas.png\"), width = 800, height = 500)\nplot_boxplot()\ndev.off()\n\nquartz_off_screen \n                2 \n\n\n\n\n\n\n\n\nFigure¬†1: Distribuci√≥n de precipitaci√≥n mensual en Las Ramadas (1971-2015)"
  },
  {
    "objectID": "spei.html#visualizaci√≥n-√≠ndice-spei",
    "href": "spei.html#visualizaci√≥n-√≠ndice-spei",
    "title": "An√°lisis de Precipitaci√≥n y SPEI",
    "section": "4. Visualizaci√≥n: √çndice SPEI",
    "text": "4. Visualizaci√≥n: √çndice SPEI\nEvoluci√≥n hist√≥rica de las sequ√≠as (SPEI-12 y SPEI-3).\n\n\nC√≥digo\ndatos_grafico &lt;- datos_spei %&gt;% \n  filter(year(fecha) &gt;= 1970 & year(fecha) &lt;= 2015)\n\nplot_spei &lt;- function(df, var_spei, titulo) {\n  ggplot(df, aes(x = fecha, y = .data[[var_spei]])) +\n    geom_hline(yintercept = c(1.5, 2, -1.5, -2), linetype = \"dashed\", color = \"gray60\", alpha = 0.5) +\n    geom_hline(yintercept = 0, color = \"grey40\", linewidth = 0.4) +\n    \n    geom_col(aes(fill = .data[[var_spei]] &gt;= 0), width = 30) +\n    \n    facet_wrap(~ estacion, ncol = 1, scales = \"free_x\") +\n    \n    scale_fill_manual(\n      values = c(\"TRUE\" = \"#6a994e\", \"FALSE\" = \"darkred\"), \n      labels = c(\"TRUE\" = \"Periodos H√∫medos\", \"FALSE\" = \"Periodos Secos\"),\n      name = NULL,\n      na.translate = FALSE \n    ) +\n    \n    # MODIFICACI√ìN: Forzar que aparezcan todos los n√∫meros enteros en el eje Y\n    scale_y_continuous(breaks = seq(-10, 10, 1)) +\n    \n    labs(title = titulo, x = \"A√±o\", y = \"SPEI\") +\n    theme_minimal(base_size = 13) +\n    theme(\n      plot.title = element_text(hjust = 0.5, face = \"bold\"), \n      strip.text = element_text(face=\"bold\"),\n      legend.position = \"top\", \n      legend.justification = \"right\",\n      legend.box.margin = margin(0, 0, -5, 0)\n    )\n}\n\ng12 &lt;- plot_spei(datos_grafico, \"spei_12\", \"SPEI 12 Meses (1970-2015)\")\ng03 &lt;- plot_spei(datos_grafico, \"spei_03\", \"SPEI 3 Meses (1970-2015)\")\n\nprint(g12)\nprint(g03)\n\nggsave(path(dir_figuras, \"spei_12.png\"), g12, width = 10, height = 6, dpi = 300)\nggsave(path(dir_figuras, \"spei_03.png\"), g03, width = 10, height = 6, dpi = 300)\n\n\n\n\n\n\n\n\nFigura¬†3: Evoluci√≥n del √≠ndice SPEI a 12 y 3 meses\n\n\n\n\n\n\n\n\n\n\n\nFigura¬†4: Evoluci√≥n del √≠ndice SPEI a 12 y 3 meses"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "An√°lisis exploratorio de la sequ√≠a en la Precordillera del Limar√≠ (Regi√≥n de Coquimbo, Chile)",
    "section": "",
    "text": "Inicio de las veranadas en el R√≠o Cogot√≠ (Fuente: Diario El Combarbalino)\n\n\nLa precordillera del Limar√≠ se encuentra compuesta por las comunas de Monte Patria y Combarbal√° (Regi√≥n de Coquimbo), se caracteriza por su clima semi√°rido, con veranos secos e inviernos con breves precipitaciones. Esto se debe principalmente a que la zona (Al igual que el resto del Norte chico) es altamente sensible al ENSO - El Ni√±o Oscilaci√≥n Sur (Meza, 2013), un patr√≥n clim√°tico natural en el Pac√≠fico que incluye fases c√°lidas (El Ni√±o) y fr√≠as (La Ni√±a). Este fen√≥meno oscila cada 2 a 7 a√±os y genera diferencias importantes en los patrones de precipitaci√≥n, temperatura y humedad.\nLos habitantes de la precordillera se han adaptado a esta oscilaci√≥n teniendo un sistema de pastoreo conocido como transhumancia, la cual se divide las zonas de pastoreo en veranada e invernada. Esta forma de ganader√≠a tradicional regula los tiempos de pastoreo en funci√≥n de la disponibilidad de recursos h√≠dricos y es una forma de adaptarse a la oscilaci√≥n constante de precipitaciones producto del ENSO (Erazo & Garay-Fl√ºhmann, 2011). A pesar de esta adaptaci√≥n tradicional, los crianceros reportan en la actualidad que la temporada de veranadas est√° cambiando por una disminuci√≥n nunca antes vista sobre la disponibilidad de agua y pasto.\nPara analizar la disponibilidad de recursos h√≠dricos en la zona de estudio, se realiz√≥ un an√°lisis exploratorio en dos estaciones meteorol√≥gicas: Cogot√≠ (Comuna de Combarbal√°) y Las Ramadas (Comuna de Monte Patria) durante el periodo 1970-2015. Este an√°lisis incluye la creaci√≥n de boxplots de precipitaci√≥n mensual y l√≠neas de tiempo del √çndice de Precipitaci√≥n-Evapotranspiraci√≥n Estandarizado (SPEI) para identificar los periodos de sequ√≠a en la zona que se denominar√° a continuaci√≥n como Limar√≠ Precordillerano."
  },
  {
    "objectID": "index.html#introducci√≥n",
    "href": "index.html#introducci√≥n",
    "title": "An√°lisis exploratorio de la sequ√≠a en la Precordillera del Limar√≠ (Regi√≥n de Coquimbo, Chile)",
    "section": "",
    "text": "Inicio de las veranadas en el R√≠o Cogot√≠ (Fuente: Diario El Combarbalino)\n\n\nLa precordillera del Limar√≠ se encuentra compuesta por las comunas de Monte Patria y Combarbal√° (Regi√≥n de Coquimbo), se caracteriza por su clima semi√°rido, con veranos secos e inviernos con breves precipitaciones. Esto se debe principalmente a que la zona (Al igual que el resto del Norte chico) es altamente sensible al ENSO - El Ni√±o Oscilaci√≥n Sur (Meza, 2013), un patr√≥n clim√°tico natural en el Pac√≠fico que incluye fases c√°lidas (El Ni√±o) y fr√≠as (La Ni√±a). Este fen√≥meno oscila cada 2 a 7 a√±os y genera diferencias importantes en los patrones de precipitaci√≥n, temperatura y humedad.\nLos habitantes de la precordillera se han adaptado a esta oscilaci√≥n teniendo un sistema de pastoreo conocido como transhumancia, la cual se divide las zonas de pastoreo en veranada e invernada. Esta forma de ganader√≠a tradicional regula los tiempos de pastoreo en funci√≥n de la disponibilidad de recursos h√≠dricos y es una forma de adaptarse a la oscilaci√≥n constante de precipitaciones producto del ENSO (Erazo & Garay-Fl√ºhmann, 2011). A pesar de esta adaptaci√≥n tradicional, los crianceros reportan en la actualidad que la temporada de veranadas est√° cambiando por una disminuci√≥n nunca antes vista sobre la disponibilidad de agua y pasto.\nPara analizar la disponibilidad de recursos h√≠dricos en la zona de estudio, se realiz√≥ un an√°lisis exploratorio en dos estaciones meteorol√≥gicas: Cogot√≠ (Comuna de Combarbal√°) y Las Ramadas (Comuna de Monte Patria) durante el periodo 1970-2015. Este an√°lisis incluye la creaci√≥n de boxplots de precipitaci√≥n mensual y l√≠neas de tiempo del √çndice de Precipitaci√≥n-Evapotranspiraci√≥n Estandarizado (SPEI) para identificar los periodos de sequ√≠a en la zona que se denominar√° a continuaci√≥n como Limar√≠ Precordillerano."
  },
  {
    "objectID": "index.html#√°rea-de-estudio",
    "href": "index.html#√°rea-de-estudio",
    "title": "An√°lisis exploratorio de la sequ√≠a en la Precordillera del Limar√≠ (Regi√≥n de Coquimbo, Chile)",
    "section": "√Årea de Estudio",
    "text": "√Årea de Estudio"
  },
  {
    "objectID": "index.html#precipitaci√≥n-mensual",
    "href": "index.html#precipitaci√≥n-mensual",
    "title": "An√°lisis exploratorio de la sequ√≠a en la Precordillera del Limar√≠ (Regi√≥n de Coquimbo, Chile)",
    "section": "Precipitaci√≥n mensual",
    "text": "Precipitaci√≥n mensual\nLa precipitaci√≥n en este sector se caracteriza ser casi nula entre los meses de noviembre y febrero. La recarga h√≠drica de la comuna se da durante los meses de mayo y agosto (periodo de invernada), donde se activan las quebradas que recargan los r√≠os y nieva en la cordillera.\nEn la estaci√≥n Las Ramadas, la precipitaci√≥n se observa de la siguiente forma:"
  },
  {
    "objectID": "index.html#exploraci√≥n-de-datos",
    "href": "index.html#exploraci√≥n-de-datos",
    "title": "An√°lisis exploratorio de la sequ√≠a en la Precordillera del Limar√≠ (Regi√≥n de Coquimbo, Chile)",
    "section": "Exploraci√≥n de datos",
    "text": "Exploraci√≥n de datos\n\nUna serie con los registros de cada estaci√≥n.\nGr√°ficos del SPEI a 12 meses, que permiten ver tendencias de sequ√≠a prolongada en el tiempo. \nGr√°ficos del SPEI a 3 meses, √∫tiles para variaciones m√°s r√°pidas en la disponibilidad h√≠drica, siendo √∫til para evaluar los efectos en actividades de agricultura y ganader√≠a.\n\n\nPuedes ir directamente al an√°lisis detallado ac√°:\n\nüëâ Ver an√°lisis SPEI\n\n\n\n\n## Conclusiones"
  },
  {
    "objectID": "index.html#notas-t√©cnicas",
    "href": "index.html#notas-t√©cnicas",
    "title": "An√°lisis exploratorio de la sequ√≠a en la Precordillera del Limar√≠ (Regi√≥n de Coquimbo, Chile)",
    "section": "Notas t√©cnicas",
    "text": "Notas t√©cnicas\n\nDatos provenientes de la plataforma https://explorador.cr2.cl del Centro de Ciencia del Clima y Resiliencia (CR2)\nDatos utilizados: series mensuales de precipitaci√≥n (mm), temperatura m√°xima (¬∞C) y m√≠nima (¬∞C).\nUso del paquete SPEI en RStudio con el c√°lculo de Evotranspiraci√≥n: funci√≥n hargreaves()\nC√°lculo de SPEI: funci√≥n spei() del mismo paquete, para escalas de 3 y 12 meses.\nSitio generado con Quarto y publicado como website est√°tico."
  },
  {
    "objectID": "index.html#bibliograf√≠a",
    "href": "index.html#bibliograf√≠a",
    "title": "An√°lisis exploratorio de la sequ√≠a en la Precordillera del Limar√≠ (Regi√≥n de Coquimbo, Chile)",
    "section": "Bibliograf√≠a",
    "text": "Bibliograf√≠a\nErazo, M. B., & Garay-Fl√ºhmann, R. (2011). Tierras secas e identidad. Una aproximaci√≥n cultural a las pr√°cticas de subsistencia de las comunidades campesinas del semi√°rido: Provincia de Elqui, Chile. Revista de Geograf√≠a Norte Grande, (50), 45-61.\nMeza, F. J. (2013). Recent trends and ENSO influence on droughts in Northern Chile: An application of the Standardized Precipitation Evapotranspiration Index. Weather and Climate extremes, 1, 51-58."
  },
  {
    "objectID": "pagina-quarto/index.html",
    "href": "pagina-quarto/index.html",
    "title": "An√°lisis exploratorio de la sequ√≠a en Combarbal√° (Regi√≥n de Coquimbo, Chile)",
    "section": "",
    "text": "Inicio de las veranadas en el R√≠o Cogot√≠ (Fuente: Diario El Combarbalino)\n\n\nCombarbal√° es una comuna rural de la Regi√≥n de Coquimbo caracterizada por tener un clima semi√°rido de veranos secos e inviernos con altas precipitaciones. Esto se debe principalmente a que la comuna (Al igual que el resto del Norte chico) es altamente sensible al ENSO - El Ni√±o Oscilaci√≥n Sur, un patr√≥n clim√°tico natural en el Pac√≠fico que incluye fases c√°lidas (El Ni√±o) y fr√≠as (La Ni√±a). Este fen√≥meno oscila cada 2 a 7 a√±os y genera diferencias importantes en los patrones de precipitaci√≥n, temperatura y humedad.\nLas comunidades rurales de la comuna se han adaptado a esta oscilaci√≥n teniendo un sistema de pastoreo que adem√°s est√° presente en todo el norte chico: La transhumancia o criancer√≠a caprina, la cual se divide las zonas de pastoreo en veranada e invernada. Esta forma de ganader√≠a tradicional regula los tiempos de pastoreo en funci√≥n de la disponibilidad de recursos h√≠dricos y es una forma de adaptarse a la oscilaci√≥n constante de precipitaciones producto del ENSO. A pesar de esta adaptaci√≥n, los crianceros reportan en la actualidad que las veranadas est√°n cambiando por una disminuci√≥n nunca antes vista sobre la disponibilidad de agua y pasto\nPara analizar la disponibilidad de recursos h√≠dricos, se realiz√≥ un estudio exploratorio en el periodo 1970-2015 en dos estaciones meteorol√≥gicas de la comuna: Cogot√≠ y Las Ramadas. Este an√°lisis incluye la creaci√≥n de boxplots de precipitaci√≥n mensual y l√≠neas de tiempo del √çndice de Precipitaci√≥n-Evapotranspiraci√≥n Estandarizado (SPEI) para identificar los periodos de sequ√≠a en la comuna."
  },
  {
    "objectID": "pagina-quarto/index.html#introducci√≥n",
    "href": "pagina-quarto/index.html#introducci√≥n",
    "title": "An√°lisis exploratorio de la sequ√≠a en Combarbal√° (Regi√≥n de Coquimbo, Chile)",
    "section": "",
    "text": "Inicio de las veranadas en el R√≠o Cogot√≠ (Fuente: Diario El Combarbalino)\n\n\nCombarbal√° es una comuna rural de la Regi√≥n de Coquimbo caracterizada por tener un clima semi√°rido de veranos secos e inviernos con altas precipitaciones. Esto se debe principalmente a que la comuna (Al igual que el resto del Norte chico) es altamente sensible al ENSO - El Ni√±o Oscilaci√≥n Sur, un patr√≥n clim√°tico natural en el Pac√≠fico que incluye fases c√°lidas (El Ni√±o) y fr√≠as (La Ni√±a). Este fen√≥meno oscila cada 2 a 7 a√±os y genera diferencias importantes en los patrones de precipitaci√≥n, temperatura y humedad.\nLas comunidades rurales de la comuna se han adaptado a esta oscilaci√≥n teniendo un sistema de pastoreo que adem√°s est√° presente en todo el norte chico: La transhumancia o criancer√≠a caprina, la cual se divide las zonas de pastoreo en veranada e invernada. Esta forma de ganader√≠a tradicional regula los tiempos de pastoreo en funci√≥n de la disponibilidad de recursos h√≠dricos y es una forma de adaptarse a la oscilaci√≥n constante de precipitaciones producto del ENSO. A pesar de esta adaptaci√≥n, los crianceros reportan en la actualidad que las veranadas est√°n cambiando por una disminuci√≥n nunca antes vista sobre la disponibilidad de agua y pasto\nPara analizar la disponibilidad de recursos h√≠dricos, se realiz√≥ un estudio exploratorio en el periodo 1970-2015 en dos estaciones meteorol√≥gicas de la comuna: Cogot√≠ y Las Ramadas. Este an√°lisis incluye la creaci√≥n de boxplots de precipitaci√≥n mensual y l√≠neas de tiempo del √çndice de Precipitaci√≥n-Evapotranspiraci√≥n Estandarizado (SPEI) para identificar los periodos de sequ√≠a en la comuna."
  },
  {
    "objectID": "pagina-quarto/index.html#√°rea-de-estudio",
    "href": "pagina-quarto/index.html#√°rea-de-estudio",
    "title": "An√°lisis exploratorio de la sequ√≠a en Combarbal√° (Regi√≥n de Coquimbo, Chile)",
    "section": "√Årea de Estudio",
    "text": "√Årea de Estudio\n\n\n\nMapa de la comuna de Combarbal√° y las estaciones meteorol√≥gicas utilizadas)"
  },
  {
    "objectID": "pagina-quarto/index.html#precipitaci√≥n-mensual",
    "href": "pagina-quarto/index.html#precipitaci√≥n-mensual",
    "title": "An√°lisis exploratorio de la sequ√≠a en Combarbal√° (Regi√≥n de Coquimbo, Chile)",
    "section": "Precipitaci√≥n mensual",
    "text": "Precipitaci√≥n mensual\nLa precipitaci√≥n en Combarbal√° se caracteriza ser casi nula entre los meses de noviembre y febrero. La recarga h√≠drica de la comuna se da durante los meses de mayo y agosto (periodo de invernada), donde se activan las quebradas que recargan los r√≠os y nieva en la cordillera.\nEn la estaci√≥n Las Ramadas, la precipitaci√≥n se observa de la siguiente manera:\n\n\n\nBoxplot de precipitaci√≥n en Las Ramadas"
  },
  {
    "objectID": "pagina-quarto/index.html#exploraci√≥n-de-datos",
    "href": "pagina-quarto/index.html#exploraci√≥n-de-datos",
    "title": "An√°lisis exploratorio de la sequ√≠a en Combarbal√° (Regi√≥n de Coquimbo, Chile)",
    "section": "Exploraci√≥n de datos",
    "text": "Exploraci√≥n de datos\n\nUna serie con los registros de cada estaci√≥n.\nGr√°ficos del SPEI a 12 meses, que permiten ver tendencias de sequ√≠a prolongada en el tiempo. \nGr√°ficos del SPEI a 3 meses, √∫tiles para variaciones m√°s r√°pidas en la disponibilidad h√≠drica, siendo √∫til para evaluar los efectos en actividades de agricultura y ganader√≠a.\n\n\nPuedes ir directamente al an√°lisis detallado ac√°:\n\nüëâ Ver an√°lisis SPEI\n\n\n\n\n## Conclusiones"
  },
  {
    "objectID": "pagina-quarto/index.html#notas-t√©cnicas",
    "href": "pagina-quarto/index.html#notas-t√©cnicas",
    "title": "An√°lisis exploratorio de la sequ√≠a en Combarbal√° (Regi√≥n de Coquimbo, Chile)",
    "section": "Notas t√©cnicas",
    "text": "Notas t√©cnicas\n\nDatos provenientes de la plataforma https://explorador.cr2.cl del Centro de Ciencia del Clima y Resiliencia (CR2)\nDatos utilizados: series mensuales de precipitaci√≥n (mm), temperatura m√°xima (¬∞C) y m√≠nima (¬∞C).\nUso del paquete SPEI en RStudio con el c√°lculo de Evotranspiraci√≥n: funci√≥n hargreaves()\nC√°lculo de SPEI: funci√≥n spei() del mismo paquete, para escalas de 3 y 12 meses.\nSitio generado con Quarto y publicado como website est√°tico."
  },
  {
    "objectID": "pagina-quarto/index.html#bibliograf√≠a",
    "href": "pagina-quarto/index.html#bibliograf√≠a",
    "title": "An√°lisis exploratorio de la sequ√≠a en Combarbal√° (Regi√≥n de Coquimbo, Chile)",
    "section": "Bibliograf√≠a",
    "text": "Bibliograf√≠a"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "Sobre el Proyecto",
    "section": "",
    "text": "About this site\n\nbroadside image: (imagenes/IMG.jpg)\n\nContacto href: ignacio.pizarro@uc.cl\n\n\nAn√°lisis de Sequ√≠a en Combarbal√°\nEste proyecto busca analizar el comportamiento hist√≥rico de las precipitaciones y la severidad de las sequ√≠as en la comuna de Combarbal√°, Regi√≥n de Coquimbo, utilizando el √çndice Estandarizado de Precipitaci√≥n y Evapotranspiraci√≥n (SPEI).\nEl objetivo es proporcionar informaci√≥n visual y estad√≠stica que permita entender c√≥mo ha cambiado la disponibilidad h√≠drica en las √∫ltimas d√©cadas, afectando actividades tradicionales como la criancer√≠a y la agricultura.\nFuentes de Datos\nPrecipitaciones y Temperatura: Centro de Ciencia del Clima y Resiliencia (CR2).\nMetodolog√≠a: C√°lculo de balance h√≠drico mediante m√©todo de Hargreaves y estandarizaci√≥n con paquete SPEI en R."
  },
  {
    "objectID": "pagina-quarto/spei.html",
    "href": "pagina-quarto/spei.html",
    "title": "An√°lisis de Precipitaci√≥n y SPEI",
    "section": "",
    "text": "Cargamos las librer√≠as necesarias y definimos las rutas de los 6 archivos crudos (Precipitaci√≥n, T.M√°x y T.M√≠n para cada estaci√≥n).\n\n\nC√≥digo\n# Limpiar memoria\nrm(list = ls())\n\n# 1. Cargar paquetes\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(tidyverse, SPEI, lubridate, fs, here)\n\n# 2. Definir Rutas de Datos Crudos\n# Asumimos que los archivos est√°n en \"data/data_raw/\" con nombres simplificados\n# (Si usas los nombres largos originales, c√°mbialos aqu√≠)\n\n# Estaci√≥n Las Ramadas\nruta_ram_pp   &lt;- here::here(\"data\", \"data_raw\", \"ramadas_pmen.csv\")\nruta_ram_tmax &lt;- here::here(\"data\", \"data_raw\", \"ramadas_tmax.csv\")\nruta_ram_tmin &lt;- here::here(\"data\", \"data_raw\", \"ramadas_tmin.csv\")\n\n# Estaci√≥n Cogot√≠\nruta_cog_pp   &lt;- here::here(\"data\", \"data_raw\", \"cogoti_pmen.csv\")\nruta_cog_tmax &lt;- here::here(\"data\", \"data_raw\", \"cogoti_tmax.csv\")\nruta_cog_tmin &lt;- here::here(\"data\", \"data_raw\", \"cogoti_tmin.csv\")\n\n# Rutas de Salida\ndir_figuras   &lt;- here::here(\"figuras\")\ndir_data_proc &lt;- here::here(\"data\", \"data_procesada\")\n\n# 3. Verificaci√≥n r√°pida\narchivos_requeridos &lt;- c(ruta_ram_pp, ruta_ram_tmax, ruta_ram_tmin, \n                         ruta_cog_pp, ruta_cog_tmax, ruta_cog_tmin)\n\nexistencia &lt;- file.exists(archivos_requeridos)\nif (!all(existencia)) {\n  stop(\"ERROR: Faltan archivos en data/data_raw/. Verifica los nombres.\\nFaltan: \", \n       paste(archivos_requeridos[!existencia], collapse = \"\\n\"))\n}\n\n# Crear carpetas de salida\nif (!dir.exists(dir_figuras)) dir.create(dir_figuras, recursive = TRUE)\nif (!dir.exists(dir_data_proc)) dir.create(dir_data_proc, recursive = TRUE)\n\nmessage(\"Configuraci√≥n exitosa. Archivos crudos encontrados.\")\n\n\n\nProcesamiento e Integraci√≥n de Datos\n\nEn esta etapa leemos los archivos individuales de temperatura y precipitaci√≥n, los unimos por a√±o y mes, y calculamos el balance h√≠drico.\n\n\nC√≥digo\n# Funci√≥n auxiliar para leer y preparar cada archivo\n# Lee el CSV, selecciona solo a√±o/mes/valor y renombra la columna valor\nleer_variable &lt;- function(ruta, nombre_var) {\n  read_csv(ruta, show_col_types = FALSE) %&gt;%\n    select(agno, mes, valor) %&gt;%\n    rename(!!nombre_var := valor) # Renombra 'valor' a 'pmen', 'tmax' o 'tmin'\n}\n\n# --- PROCESAMIENTO LAS RAMADAS ---\nram_pp   &lt;- leer_variable(ruta_ram_pp, \"pmen\")\nram_tmax &lt;- leer_variable(ruta_ram_tmax, \"tmax\")\nram_tmin &lt;- leer_variable(ruta_ram_tmin, \"tmin\")\n\n# Unir las 3 variables (full_join para no perder meses si falta alg√∫n dato)\ndf_ramadas &lt;- list(ram_pp, ram_tmax, ram_tmin) %&gt;%\n  reduce(full_join, by = c(\"agno\", \"mes\")) %&gt;%\n  mutate(estacion = \"Las Ramadas\")\n\n# --- PROCESAMIENTO COGOT√ç ---\ncog_pp   &lt;- leer_variable(ruta_cog_pp, \"pmen\")\ncog_tmax &lt;- leer_variable(ruta_cog_tmax, \"tmax\")\ncog_tmin &lt;- leer_variable(ruta_cog_tmin, \"tmin\")\n\ndf_cogoti &lt;- list(cog_pp, cog_tmax, cog_tmin) %&gt;%\n  reduce(full_join, by = c(\"agno\", \"mes\")) %&gt;%\n  mutate(estacion = \"Cogot√≠\")\n\n# - --- UNIFICACI√ìN Y C√ÅLCULOS ---\ndatos &lt;- bind_rows(df_ramadas, df_cogoti) %&gt;%\n  mutate(fecha = make_date(agno, mes, 1)) %&gt;%\n  # --- CORRECCI√ìN CLAVE AQU√ç ---\n  # Eliminamos filas sin temperatura ANTES de calcular hargreaves\n  drop_na(tmax, tmin) %&gt;%\n  mutate(\n    # Ahora s√≠ podemos calcular ETP sin errores\n    etp = hargreaves(tmin, tmax, lat = -31.0358),\n    bal = pmen - etp\n  ) %&gt;%\n  # Limpiamos si falta precipitaci√≥n o balance final\n  drop_na(bal) %&gt;%\n  arrange(estacion, fecha)\n\n\n[1] \"Calculating reference evapotranspiration using the Hargreaves method. Using latitude (`lat`) to estimate extraterrestrial radiation. Checking for missing values (`NA`): all the data must be complete. Input type is vector. Assuming the data are monthly time series starting in January, all regular (non-leap) years.\"\n\n\nC√≥digo\n# Guardar CSV procesado completo\nwrite_csv(datos, path(dir_data_proc, \"datos_procesados_unificados.csv\"))\n\n# --- C√ÅLCULO DE SPEI ---\ndatos_spei &lt;- datos %&gt;%\n  group_by(estacion) %&gt;%\n  nest() %&gt;%\n  mutate(\n    spei_12 = map(data, ~ as.numeric(spei(.x$bal, 12)$fitted)),\n    spei_03 = map(data, ~ as.numeric(spei(.x$bal, 3)$fitted))\n  ) %&gt;%\n  unnest(cols = c(data, spei_12, spei_03)) %&gt;% \n  ungroup()\n\n\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 12. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 12. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 3. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 3. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n\n\nC√≥digo\n# Mostrar un resumen\nglimpse(datos_spei)\n\n\nRows: 1,165\nColumns: 11\n$ estacion &lt;chr&gt; \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"‚Ä¶\n$ agno     &lt;dbl&gt; 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1‚Ä¶\n$ mes      &lt;dbl&gt; 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, 7, 8, 9‚Ä¶\n$ pmen     &lt;dbl&gt; 0.0, 0.0, 2.0, 38.0, 2.4, 153.5, 161.5, 0.0, 0.0, 1.2, 0.0, 0‚Ä¶\n$ tmax     &lt;dbl&gt; 28.9, 25.9, 23.3, 21.4, 21.9, 17.0, 16.0, 19.4, 22.8, 24.6, 2‚Ä¶\n$ tmin     &lt;dbl&gt; 16.3, 13.7, 11.3, 8.4, 8.4, 5.8, 6.0, 6.9, 9.4, 11.3, 14.0, 1‚Ä¶\n$ fecha    &lt;date&gt; 1965-02-01, 1965-03-01, 1965-04-01, 1965-05-01, 1965-06-01, ‚Ä¶\n$ etp      &lt;dbl&gt; 169.68881, 168.07156, 152.84507, 122.46746, 119.65757, 73.512‚Ä¶\n$ bal      &lt;dbl&gt; -169.68881, -168.07156, -150.84507, -84.46746, -117.25757, 79‚Ä¶\n$ spei_12  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 1.3954235, 1.3959‚Ä¶\n$ spei_03  &lt;dbl&gt; NA, NA, -0.07306118, 0.24514050, -0.38907950, 0.88506499, 1.5‚Ä¶\n\n\n\nVisualizaci√≥n: Precipitaci√≥n Mensual\n\nAn√°lisis de la distribuci√≥n de lluvias para la estaci√≥n Las Ramadas (1970-2015).\n\n\nC√≥digo\n# Filtrar datos (Rango ajustado 1970-2015)\ndf_box &lt;- datos_spei %&gt;% \n  filter(estacion == \"Las Ramadas\", year(fecha) &gt;= 1970 & year(fecha) &lt;= 2015)\n\n# Calcular colores\nmedianas &lt;- tapply(df_box$pmen, df_box$mes, median, na.rm=TRUE)\npaleta   &lt;- colorRampPalette(c(\"#E0F3DB\", \"#084081\"))(100)\ncolores  &lt;- paleta[findInterval(medianas, seq(min(medianas), max(medianas), length.out = 100))]\nmeses_esp &lt;- c(\"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\", \"Jul\", \"Ago\", \"Sep\", \"Oct\", \"Nov\", \"Dic\")\n\n# Funci√≥n de ploteo\nplot_boxplot &lt;- function() {\n  par(mar = c(4, 5, 3, 1))\n  boxplot(pmen ~ factor(mes, levels=1:12, labels = meses_esp), data = df_box,\n          col = colores, outline = FALSE, main = \"Pp Mensual Ramadas (1970-2015)\",\n          ylab = \"Pp (mm)\", las = 1, varwidth = TRUE)\n  grid(nx = NA, ny = NULL, lty = 3)\n  legend(\"topright\", legend=c(\"H√∫medo\",\"Seco\"), fill=c(paleta[100], paleta[1]), bty=\"n\", cex=0.8)\n}\n\nplot_boxplot()\n\n# Guardar PNG\npng(path(dir_figuras, \"boxplot_ramadas.png\"), width = 800, height = 500)\nplot_boxplot()\ndev.off()\n\n\nquartz_off_screen \n                2 \n\n\n\n\n\n\n\n\nFigura¬†1: Distribuci√≥n de precipitaci√≥n mensual en Las Ramadas (1970-2015)\n\n\n\n\n\n\nVisualizaci√≥n: √çndice SPEI\n\nEvoluci√≥n hist√≥rica de las sequ√≠as (SPEI-12 y SPEI-3).\n\n\nC√≥digo\n# Filtrar datos para gr√°fico\ndatos_grafico &lt;- datos_spei %&gt;% \n  filter(year(fecha) &gt;= 1970 & year(fecha) &lt;= 2015)\n\n# Funci√≥n para gr√°ficos\nplot_spei &lt;- function(df, var_spei, titulo) {\n  ggplot(df, aes(x = fecha, y = .data[[var_spei]])) +\n    geom_hline(yintercept = 0, color = \"grey40\", linewidth = 0.4) +\n    geom_col(aes(fill = .data[[var_spei]] &gt;= 0), width = 30) +\n    facet_wrap(~ estacion, ncol = 1, scales = \"free_x\") +\n    scale_fill_manual(values = c(\"TRUE\" = \"#6a994e\", \"FALSE\" = \"darkred\"), guide = \"none\") +\n    labs(title = titulo, x = \"A√±o\", y = \"SPEI\") +\n    theme_minimal(base_size = 13) +\n    theme(plot.title = element_text(hjust = 0.5, face = \"bold\"), \n          strip.text = element_text(face=\"bold\"))\n}\n\ng12 &lt;- plot_spei(datos_grafico, \"spei_12\", \"SPEI 12 Meses (1970-2015)\")\ng03 &lt;- plot_spei(datos_grafico, \"spei_03\", \"SPEI 3 Meses (1970-2015)\")\n\nprint(g12)\nprint(g03)\n\nggsave(path(dir_figuras, \"spei_12.png\"), g12, width = 10, height = 6, dpi = 300)\nggsave(path(dir_figuras, \"spei_03.png\"), g03, width = 10, height = 6, dpi = 300)\n\n\n\n\n\n\n\n\nFigura¬†2: Evoluci√≥n del √≠ndice SPEI a 12 y 3 meses\n\n\n\n\n\n\n\n\n\n\n\nFigura¬†3: Evoluci√≥n del √≠ndice SPEI a 12 y 3 meses"
  },
  {
    "objectID": "pagina-quarto/spei.html#configuraci√≥n-inicial",
    "href": "pagina-quarto/spei.html#configuraci√≥n-inicial",
    "title": "An√°lisis de Precipitaci√≥n y SPEI",
    "section": "",
    "text": "Cargamos las librer√≠as necesarias y definimos las rutas de los 6 archivos crudos (Precipitaci√≥n, T.M√°x y T.M√≠n para cada estaci√≥n).\n\n\nC√≥digo\n# Limpiar memoria\nrm(list = ls())\n\n# 1. Cargar paquetes\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(tidyverse, SPEI, lubridate, fs, here)\n\n# 2. Definir Rutas de Datos Crudos\n# Asumimos que los archivos est√°n en \"data/data_raw/\" con nombres simplificados\n# (Si usas los nombres largos originales, c√°mbialos aqu√≠)\n\n# Estaci√≥n Las Ramadas\nruta_ram_pp   &lt;- here::here(\"data\", \"data_raw\", \"ramadas_pmen.csv\")\nruta_ram_tmax &lt;- here::here(\"data\", \"data_raw\", \"ramadas_tmax.csv\")\nruta_ram_tmin &lt;- here::here(\"data\", \"data_raw\", \"ramadas_tmin.csv\")\n\n# Estaci√≥n Cogot√≠\nruta_cog_pp   &lt;- here::here(\"data\", \"data_raw\", \"cogoti_pmen.csv\")\nruta_cog_tmax &lt;- here::here(\"data\", \"data_raw\", \"cogoti_tmax.csv\")\nruta_cog_tmin &lt;- here::here(\"data\", \"data_raw\", \"cogoti_tmin.csv\")\n\n# Rutas de Salida\ndir_figuras   &lt;- here::here(\"figuras\")\ndir_data_proc &lt;- here::here(\"data\", \"data_procesada\")\n\n# 3. Verificaci√≥n r√°pida\narchivos_requeridos &lt;- c(ruta_ram_pp, ruta_ram_tmax, ruta_ram_tmin, \n                         ruta_cog_pp, ruta_cog_tmax, ruta_cog_tmin)\n\nexistencia &lt;- file.exists(archivos_requeridos)\nif (!all(existencia)) {\n  stop(\"ERROR: Faltan archivos en data/data_raw/. Verifica los nombres.\\nFaltan: \", \n       paste(archivos_requeridos[!existencia], collapse = \"\\n\"))\n}\n\n# Crear carpetas de salida\nif (!dir.exists(dir_figuras)) dir.create(dir_figuras, recursive = TRUE)\nif (!dir.exists(dir_data_proc)) dir.create(dir_data_proc, recursive = TRUE)\n\nmessage(\"Configuraci√≥n exitosa. Archivos crudos encontrados.\")\n\n\n\nProcesamiento e Integraci√≥n de Datos\n\nEn esta etapa leemos los archivos individuales de temperatura y precipitaci√≥n, los unimos por a√±o y mes, y calculamos el balance h√≠drico.\n\n\nC√≥digo\n# Funci√≥n auxiliar para leer y preparar cada archivo\n# Lee el CSV, selecciona solo a√±o/mes/valor y renombra la columna valor\nleer_variable &lt;- function(ruta, nombre_var) {\n  read_csv(ruta, show_col_types = FALSE) %&gt;%\n    select(agno, mes, valor) %&gt;%\n    rename(!!nombre_var := valor) # Renombra 'valor' a 'pmen', 'tmax' o 'tmin'\n}\n\n# --- PROCESAMIENTO LAS RAMADAS ---\nram_pp   &lt;- leer_variable(ruta_ram_pp, \"pmen\")\nram_tmax &lt;- leer_variable(ruta_ram_tmax, \"tmax\")\nram_tmin &lt;- leer_variable(ruta_ram_tmin, \"tmin\")\n\n# Unir las 3 variables (full_join para no perder meses si falta alg√∫n dato)\ndf_ramadas &lt;- list(ram_pp, ram_tmax, ram_tmin) %&gt;%\n  reduce(full_join, by = c(\"agno\", \"mes\")) %&gt;%\n  mutate(estacion = \"Las Ramadas\")\n\n# --- PROCESAMIENTO COGOT√ç ---\ncog_pp   &lt;- leer_variable(ruta_cog_pp, \"pmen\")\ncog_tmax &lt;- leer_variable(ruta_cog_tmax, \"tmax\")\ncog_tmin &lt;- leer_variable(ruta_cog_tmin, \"tmin\")\n\ndf_cogoti &lt;- list(cog_pp, cog_tmax, cog_tmin) %&gt;%\n  reduce(full_join, by = c(\"agno\", \"mes\")) %&gt;%\n  mutate(estacion = \"Cogot√≠\")\n\n# - --- UNIFICACI√ìN Y C√ÅLCULOS ---\ndatos &lt;- bind_rows(df_ramadas, df_cogoti) %&gt;%\n  mutate(fecha = make_date(agno, mes, 1)) %&gt;%\n  # --- CORRECCI√ìN CLAVE AQU√ç ---\n  # Eliminamos filas sin temperatura ANTES de calcular hargreaves\n  drop_na(tmax, tmin) %&gt;%\n  mutate(\n    # Ahora s√≠ podemos calcular ETP sin errores\n    etp = hargreaves(tmin, tmax, lat = -31.0358),\n    bal = pmen - etp\n  ) %&gt;%\n  # Limpiamos si falta precipitaci√≥n o balance final\n  drop_na(bal) %&gt;%\n  arrange(estacion, fecha)\n\n\n[1] \"Calculating reference evapotranspiration using the Hargreaves method. Using latitude (`lat`) to estimate extraterrestrial radiation. Checking for missing values (`NA`): all the data must be complete. Input type is vector. Assuming the data are monthly time series starting in January, all regular (non-leap) years.\"\n\n\nC√≥digo\n# Guardar CSV procesado completo\nwrite_csv(datos, path(dir_data_proc, \"datos_procesados_unificados.csv\"))\n\n# --- C√ÅLCULO DE SPEI ---\ndatos_spei &lt;- datos %&gt;%\n  group_by(estacion) %&gt;%\n  nest() %&gt;%\n  mutate(\n    spei_12 = map(data, ~ as.numeric(spei(.x$bal, 12)$fitted)),\n    spei_03 = map(data, ~ as.numeric(spei(.x$bal, 3)$fitted))\n  ) %&gt;%\n  unnest(cols = c(data, spei_12, spei_03)) %&gt;% \n  ungroup()\n\n\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 12. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 12. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 3. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 3. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n\n\nC√≥digo\n# Mostrar un resumen\nglimpse(datos_spei)\n\n\nRows: 1,165\nColumns: 11\n$ estacion &lt;chr&gt; \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"‚Ä¶\n$ agno     &lt;dbl&gt; 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1‚Ä¶\n$ mes      &lt;dbl&gt; 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, 7, 8, 9‚Ä¶\n$ pmen     &lt;dbl&gt; 0.0, 0.0, 2.0, 38.0, 2.4, 153.5, 161.5, 0.0, 0.0, 1.2, 0.0, 0‚Ä¶\n$ tmax     &lt;dbl&gt; 28.9, 25.9, 23.3, 21.4, 21.9, 17.0, 16.0, 19.4, 22.8, 24.6, 2‚Ä¶\n$ tmin     &lt;dbl&gt; 16.3, 13.7, 11.3, 8.4, 8.4, 5.8, 6.0, 6.9, 9.4, 11.3, 14.0, 1‚Ä¶\n$ fecha    &lt;date&gt; 1965-02-01, 1965-03-01, 1965-04-01, 1965-05-01, 1965-06-01, ‚Ä¶\n$ etp      &lt;dbl&gt; 169.68881, 168.07156, 152.84507, 122.46746, 119.65757, 73.512‚Ä¶\n$ bal      &lt;dbl&gt; -169.68881, -168.07156, -150.84507, -84.46746, -117.25757, 79‚Ä¶\n$ spei_12  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 1.3954235, 1.3959‚Ä¶\n$ spei_03  &lt;dbl&gt; NA, NA, -0.07306118, 0.24514050, -0.38907950, 0.88506499, 1.5‚Ä¶\n\n\n\nVisualizaci√≥n: Precipitaci√≥n Mensual\n\nAn√°lisis de la distribuci√≥n de lluvias para la estaci√≥n Las Ramadas (1970-2015).\n\n\nC√≥digo\n# Filtrar datos (Rango ajustado 1970-2015)\ndf_box &lt;- datos_spei %&gt;% \n  filter(estacion == \"Las Ramadas\", year(fecha) &gt;= 1970 & year(fecha) &lt;= 2015)\n\n# Calcular colores\nmedianas &lt;- tapply(df_box$pmen, df_box$mes, median, na.rm=TRUE)\npaleta   &lt;- colorRampPalette(c(\"#E0F3DB\", \"#084081\"))(100)\ncolores  &lt;- paleta[findInterval(medianas, seq(min(medianas), max(medianas), length.out = 100))]\nmeses_esp &lt;- c(\"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\", \"Jul\", \"Ago\", \"Sep\", \"Oct\", \"Nov\", \"Dic\")\n\n# Funci√≥n de ploteo\nplot_boxplot &lt;- function() {\n  par(mar = c(4, 5, 3, 1))\n  boxplot(pmen ~ factor(mes, levels=1:12, labels = meses_esp), data = df_box,\n          col = colores, outline = FALSE, main = \"Pp Mensual Ramadas (1970-2015)\",\n          ylab = \"Pp (mm)\", las = 1, varwidth = TRUE)\n  grid(nx = NA, ny = NULL, lty = 3)\n  legend(\"topright\", legend=c(\"H√∫medo\",\"Seco\"), fill=c(paleta[100], paleta[1]), bty=\"n\", cex=0.8)\n}\n\nplot_boxplot()\n\n# Guardar PNG\npng(path(dir_figuras, \"boxplot_ramadas.png\"), width = 800, height = 500)\nplot_boxplot()\ndev.off()\n\n\nquartz_off_screen \n                2 \n\n\n\n\n\n\n\n\nFigura¬†1: Distribuci√≥n de precipitaci√≥n mensual en Las Ramadas (1970-2015)\n\n\n\n\n\n\nVisualizaci√≥n: √çndice SPEI\n\nEvoluci√≥n hist√≥rica de las sequ√≠as (SPEI-12 y SPEI-3).\n\n\nC√≥digo\n# Filtrar datos para gr√°fico\ndatos_grafico &lt;- datos_spei %&gt;% \n  filter(year(fecha) &gt;= 1970 & year(fecha) &lt;= 2015)\n\n# Funci√≥n para gr√°ficos\nplot_spei &lt;- function(df, var_spei, titulo) {\n  ggplot(df, aes(x = fecha, y = .data[[var_spei]])) +\n    geom_hline(yintercept = 0, color = \"grey40\", linewidth = 0.4) +\n    geom_col(aes(fill = .data[[var_spei]] &gt;= 0), width = 30) +\n    facet_wrap(~ estacion, ncol = 1, scales = \"free_x\") +\n    scale_fill_manual(values = c(\"TRUE\" = \"#6a994e\", \"FALSE\" = \"darkred\"), guide = \"none\") +\n    labs(title = titulo, x = \"A√±o\", y = \"SPEI\") +\n    theme_minimal(base_size = 13) +\n    theme(plot.title = element_text(hjust = 0.5, face = \"bold\"), \n          strip.text = element_text(face=\"bold\"))\n}\n\ng12 &lt;- plot_spei(datos_grafico, \"spei_12\", \"SPEI 12 Meses (1970-2015)\")\ng03 &lt;- plot_spei(datos_grafico, \"spei_03\", \"SPEI 3 Meses (1970-2015)\")\n\nprint(g12)\nprint(g03)\n\nggsave(path(dir_figuras, \"spei_12.png\"), g12, width = 10, height = 6, dpi = 300)\nggsave(path(dir_figuras, \"spei_03.png\"), g03, width = 10, height = 6, dpi = 300)\n\n\n\n\n\n\n\n\nFigura¬†2: Evoluci√≥n del √≠ndice SPEI a 12 y 3 meses\n\n\n\n\n\n\n\n\n\n\n\nFigura¬†3: Evoluci√≥n del √≠ndice SPEI a 12 y 3 meses"
  },
  {
    "objectID": "precipitacion.html",
    "href": "precipitacion.html",
    "title": "An√°lisis de Precipitaci√≥n y SPEI",
    "section": "",
    "text": "Cargamos las librer√≠as necesarias y definimos las rutas de los 6 archivos crudos (Precipitaci√≥n, T.M√°x y T.M√≠n para cada estaci√≥n).\n\n\nC√≥digo\n# Limpiar memoria\nrm(list = ls())\n\n# 1. Cargar paquetes\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(tidyverse, SPEI, lubridate, fs, here)\n\n# 2. Definir Rutas de Datos Crudos\n# Asumimos que los archivos est√°n en \"data/data_raw/\" con nombres simplificados\n# (Si usas los nombres largos originales, c√°mbialos aqu√≠)\n\n# Estaci√≥n Las Ramadas\nruta_ram_pp   &lt;- here::here(\"data\", \"data_raw\", \"ramadas_pmen.csv\")\nruta_ram_tmax &lt;- here::here(\"data\", \"data_raw\", \"ramadas_tmax.csv\")\nruta_ram_tmin &lt;- here::here(\"data\", \"data_raw\", \"ramadas_tmin.csv\")\n\n# Estaci√≥n Cogot√≠\nruta_cog_pp   &lt;- here::here(\"data\", \"data_raw\", \"cogoti_pmen.csv\")\nruta_cog_tmax &lt;- here::here(\"data\", \"data_raw\", \"cogoti_tmax.csv\")\nruta_cog_tmin &lt;- here::here(\"data\", \"data_raw\", \"cogoti_tmin.csv\")\n\n# Rutas de Salida\ndir_figuras   &lt;- here::here(\"figuras\")\ndir_data_proc &lt;- here::here(\"data\", \"data_procesada\")\n\n# 3. Verificaci√≥n r√°pida\narchivos_requeridos &lt;- c(ruta_ram_pp, ruta_ram_tmax, ruta_ram_tmin, \n                         ruta_cog_pp, ruta_cog_tmax, ruta_cog_tmin)\n\nexistencia &lt;- file.exists(archivos_requeridos)\nif (!all(existencia)) {\n  stop(\"ERROR: Faltan archivos en data/data_raw/. Verifica los nombres.\\nFaltan: \", \n       paste(archivos_requeridos[!existencia], collapse = \"\\n\"))\n}\n\n# Crear carpetas de salida\nif (!dir.exists(dir_figuras)) dir.create(dir_figuras, recursive = TRUE)\nif (!dir.exists(dir_data_proc)) dir.create(dir_data_proc, recursive = TRUE)\n\nmessage(\"Configuraci√≥n exitosa. Archivos crudos encontrados.\")\n\n\n\nProcesamiento e Integraci√≥n de Datos\n\nEn esta etapa leemos los archivos individuales de temperatura y precipitaci√≥n, los unimos por a√±o y mes, y calculamos el balance h√≠drico.\n\n\nC√≥digo\n# Funci√≥n auxiliar para leer y preparar cada archivo\n# Lee el CSV, selecciona solo a√±o/mes/valor y renombra la columna valor\nleer_variable &lt;- function(ruta, nombre_var) {\n  read_csv(ruta, show_col_types = FALSE) %&gt;%\n    select(agno, mes, valor) %&gt;%\n    rename(!!nombre_var := valor) # Renombra 'valor' a 'pmen', 'tmax' o 'tmin'\n}\n\n# --- PROCESAMIENTO LAS RAMADAS ---\nram_pp   &lt;- leer_variable(ruta_ram_pp, \"pmen\")\nram_tmax &lt;- leer_variable(ruta_ram_tmax, \"tmax\")\nram_tmin &lt;- leer_variable(ruta_ram_tmin, \"tmin\")\n\n# Unir las 3 variables (full_join para no perder meses si falta alg√∫n dato)\ndf_ramadas &lt;- list(ram_pp, ram_tmax, ram_tmin) %&gt;%\n  reduce(full_join, by = c(\"agno\", \"mes\")) %&gt;%\n  mutate(estacion = \"Las Ramadas\")\n\n# --- PROCESAMIENTO COGOT√ç ---\ncog_pp   &lt;- leer_variable(ruta_cog_pp, \"pmen\")\ncog_tmax &lt;- leer_variable(ruta_cog_tmax, \"tmax\")\ncog_tmin &lt;- leer_variable(ruta_cog_tmin, \"tmin\")\n\ndf_cogoti &lt;- list(cog_pp, cog_tmax, cog_tmin) %&gt;%\n  reduce(full_join, by = c(\"agno\", \"mes\")) %&gt;%\n  mutate(estacion = \"Cogot√≠\")\n\n# - --- UNIFICACI√ìN Y C√ÅLCULOS ---\ndatos &lt;- bind_rows(df_ramadas, df_cogoti) %&gt;%\n  mutate(fecha = make_date(agno, mes, 1)) %&gt;%\n  # --- CORRECCI√ìN CLAVE AQU√ç ---\n  # Eliminamos filas sin temperatura ANTES de calcular hargreaves\n  drop_na(tmax, tmin) %&gt;%\n  mutate(\n    # Ahora s√≠ podemos calcular ETP sin errores\n    etp = hargreaves(tmin, tmax, lat = -31.0358),\n    bal = pmen - etp\n  ) %&gt;%\n  # Limpiamos si falta precipitaci√≥n o balance final\n  drop_na(bal) %&gt;%\n  arrange(estacion, fecha)\n\n\n[1] \"Calculating reference evapotranspiration using the Hargreaves method. Using latitude (`lat`) to estimate extraterrestrial radiation. Checking for missing values (`NA`): all the data must be complete. Input type is vector. Assuming the data are monthly time series starting in January, all regular (non-leap) years.\"\n\n\nC√≥digo\n# Guardar CSV procesado completo\nwrite_csv(datos, path(dir_data_proc, \"datos_procesados_unificados.csv\"))\n\n# --- C√ÅLCULO DE SPEI ---\ndatos_spei &lt;- datos %&gt;%\n  group_by(estacion) %&gt;%\n  nest() %&gt;%\n  mutate(\n    spei_12 = map(data, ~ as.numeric(spei(.x$bal, 12)$fitted)),\n    spei_03 = map(data, ~ as.numeric(spei(.x$bal, 3)$fitted))\n  ) %&gt;%\n  unnest(cols = c(data, spei_12, spei_03)) %&gt;% \n  ungroup()\n\n\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 12. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 12. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 3. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 3. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n\n\nC√≥digo\n# Mostrar un resumen\nglimpse(datos_spei)\n\n\nRows: 1,165\nColumns: 11\n$ estacion &lt;chr&gt; \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"‚Ä¶\n$ agno     &lt;dbl&gt; 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1‚Ä¶\n$ mes      &lt;dbl&gt; 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, 7, 8, 9‚Ä¶\n$ pmen     &lt;dbl&gt; 0.0, 0.0, 2.0, 38.0, 2.4, 153.5, 161.5, 0.0, 0.0, 1.2, 0.0, 0‚Ä¶\n$ tmax     &lt;dbl&gt; 28.9, 25.9, 23.3, 21.4, 21.9, 17.0, 16.0, 19.4, 22.8, 24.6, 2‚Ä¶\n$ tmin     &lt;dbl&gt; 16.3, 13.7, 11.3, 8.4, 8.4, 5.8, 6.0, 6.9, 9.4, 11.3, 14.0, 1‚Ä¶\n$ fecha    &lt;date&gt; 1965-02-01, 1965-03-01, 1965-04-01, 1965-05-01, 1965-06-01, ‚Ä¶\n$ etp      &lt;dbl&gt; 169.68881, 168.07156, 152.84507, 122.46746, 119.65757, 73.512‚Ä¶\n$ bal      &lt;dbl&gt; -169.68881, -168.07156, -150.84507, -84.46746, -117.25757, 79‚Ä¶\n$ spei_12  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 1.3954235, 1.3959‚Ä¶\n$ spei_03  &lt;dbl&gt; NA, NA, -0.07306118, 0.24514050, -0.38907950, 0.88506499, 1.5‚Ä¶\n\n\n\nVisualizaci√≥n: Precipitaci√≥n Mensual\n\nAn√°lisis de la distribuci√≥n de lluvias para la estaci√≥n Las Ramadas (1970-2015).\n\n\nC√≥digo\n# Filtrar datos (Rango ajustado 1970-2015)\ndf_box &lt;- datos_spei %&gt;% \n  filter(estacion == \"Las Ramadas\", year(fecha) &gt;= 1970 & year(fecha) &lt;= 2015)\n\n# Calcular colores\nmedianas &lt;- tapply(df_box$pmen, df_box$mes, median, na.rm=TRUE)\npaleta   &lt;- colorRampPalette(c(\"#E0F3DB\", \"#084081\"))(100)\ncolores  &lt;- paleta[findInterval(medianas, seq(min(medianas), max(medianas), length.out = 100))]\nmeses_esp &lt;- c(\"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\", \"Jul\", \"Ago\", \"Sep\", \"Oct\", \"Nov\", \"Dic\")\n\n# Funci√≥n de ploteo\nplot_boxplot &lt;- function() {\n  par(mar = c(4, 5, 3, 1))\n  boxplot(pmen ~ factor(mes, levels=1:12, labels = meses_esp), data = df_box,\n          col = colores, outline = FALSE, main = \"Pp Mensual Ramadas (1970-2015)\",\n          ylab = \"Pp (mm)\", las = 1, varwidth = TRUE)\n  grid(nx = NA, ny = NULL, lty = 3)\n  legend(\"topright\", legend=c(\"H√∫medo\",\"Seco\"), fill=c(paleta[100], paleta[1]), bty=\"n\", cex=0.8)\n}\n\nplot_boxplot()\n\n# Guardar PNG\npng(path(dir_figuras, \"boxplot_ramadas.png\"), width = 800, height = 500)\nplot_boxplot()\ndev.off()\n\n\nquartz_off_screen \n                2 \n\n\n\n\n\n\n\n\nFigura¬†1: Distribuci√≥n de precipitaci√≥n mensual en Las Ramadas (1970-2015)\n\n\n\n\n\n\nVisualizaci√≥n: √çndice SPEI\n\nEvoluci√≥n hist√≥rica de las sequ√≠as (SPEI-12 y SPEI-3).\n\n\nC√≥digo\n# Filtrar datos para gr√°fico\ndatos_grafico &lt;- datos_spei %&gt;% \n  filter(year(fecha) &gt;= 1970 & year(fecha) &lt;= 2015)\n\n# Funci√≥n para gr√°ficos\nplot_spei &lt;- function(df, var_spei, titulo) {\n  ggplot(df, aes(x = fecha, y = .data[[var_spei]])) +\n    geom_hline(yintercept = 0, color = \"grey40\", linewidth = 0.4) +\n    geom_col(aes(fill = .data[[var_spei]] &gt;= 0), width = 30) +\n    facet_wrap(~ estacion, ncol = 1, scales = \"free_x\") +\n    scale_fill_manual(values = c(\"TRUE\" = \"#6a994e\", \"FALSE\" = \"darkred\"), guide = \"none\") +\n    labs(title = titulo, x = \"A√±o\", y = \"SPEI\") +\n    theme_minimal(base_size = 13) +\n    theme(plot.title = element_text(hjust = 0.5, face = \"bold\"), \n          strip.text = element_text(face=\"bold\"))\n}\n\ng12 &lt;- plot_spei(datos_grafico, \"spei_12\", \"SPEI 12 Meses (1970-2015)\")\ng03 &lt;- plot_spei(datos_grafico, \"spei_03\", \"SPEI 3 Meses (1970-2015)\")\n\nprint(g12)\nprint(g03)\n\nggsave(path(dir_figuras, \"spei_12.png\"), g12, width = 10, height = 6, dpi = 300)\nggsave(path(dir_figuras, \"spei_03.png\"), g03, width = 10, height = 6, dpi = 300)\n\n\n\n\n\n\n\n\nFigura¬†2: Evoluci√≥n del √≠ndice SPEI a 12 y 3 meses\n\n\n\n\n\n\n\n\n\n\n\nFigura¬†3: Evoluci√≥n del √≠ndice SPEI a 12 y 3 meses"
  },
  {
    "objectID": "precipitacion.html#configuraci√≥n-inicial",
    "href": "precipitacion.html#configuraci√≥n-inicial",
    "title": "An√°lisis de Precipitaci√≥n y SPEI",
    "section": "",
    "text": "Cargamos las librer√≠as necesarias y definimos las rutas de los 6 archivos crudos (Precipitaci√≥n, T.M√°x y T.M√≠n para cada estaci√≥n).\n\n\nC√≥digo\n# Limpiar memoria\nrm(list = ls())\n\n# 1. Cargar paquetes\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(tidyverse, SPEI, lubridate, fs, here)\n\n# 2. Definir Rutas de Datos Crudos\n# Asumimos que los archivos est√°n en \"data/data_raw/\" con nombres simplificados\n# (Si usas los nombres largos originales, c√°mbialos aqu√≠)\n\n# Estaci√≥n Las Ramadas\nruta_ram_pp   &lt;- here::here(\"data\", \"data_raw\", \"ramadas_pmen.csv\")\nruta_ram_tmax &lt;- here::here(\"data\", \"data_raw\", \"ramadas_tmax.csv\")\nruta_ram_tmin &lt;- here::here(\"data\", \"data_raw\", \"ramadas_tmin.csv\")\n\n# Estaci√≥n Cogot√≠\nruta_cog_pp   &lt;- here::here(\"data\", \"data_raw\", \"cogoti_pmen.csv\")\nruta_cog_tmax &lt;- here::here(\"data\", \"data_raw\", \"cogoti_tmax.csv\")\nruta_cog_tmin &lt;- here::here(\"data\", \"data_raw\", \"cogoti_tmin.csv\")\n\n# Rutas de Salida\ndir_figuras   &lt;- here::here(\"figuras\")\ndir_data_proc &lt;- here::here(\"data\", \"data_procesada\")\n\n# 3. Verificaci√≥n r√°pida\narchivos_requeridos &lt;- c(ruta_ram_pp, ruta_ram_tmax, ruta_ram_tmin, \n                         ruta_cog_pp, ruta_cog_tmax, ruta_cog_tmin)\n\nexistencia &lt;- file.exists(archivos_requeridos)\nif (!all(existencia)) {\n  stop(\"ERROR: Faltan archivos en data/data_raw/. Verifica los nombres.\\nFaltan: \", \n       paste(archivos_requeridos[!existencia], collapse = \"\\n\"))\n}\n\n# Crear carpetas de salida\nif (!dir.exists(dir_figuras)) dir.create(dir_figuras, recursive = TRUE)\nif (!dir.exists(dir_data_proc)) dir.create(dir_data_proc, recursive = TRUE)\n\nmessage(\"Configuraci√≥n exitosa. Archivos crudos encontrados.\")\n\n\n\nProcesamiento e Integraci√≥n de Datos\n\nEn esta etapa leemos los archivos individuales de temperatura y precipitaci√≥n, los unimos por a√±o y mes, y calculamos el balance h√≠drico.\n\n\nC√≥digo\n# Funci√≥n auxiliar para leer y preparar cada archivo\n# Lee el CSV, selecciona solo a√±o/mes/valor y renombra la columna valor\nleer_variable &lt;- function(ruta, nombre_var) {\n  read_csv(ruta, show_col_types = FALSE) %&gt;%\n    select(agno, mes, valor) %&gt;%\n    rename(!!nombre_var := valor) # Renombra 'valor' a 'pmen', 'tmax' o 'tmin'\n}\n\n# --- PROCESAMIENTO LAS RAMADAS ---\nram_pp   &lt;- leer_variable(ruta_ram_pp, \"pmen\")\nram_tmax &lt;- leer_variable(ruta_ram_tmax, \"tmax\")\nram_tmin &lt;- leer_variable(ruta_ram_tmin, \"tmin\")\n\n# Unir las 3 variables (full_join para no perder meses si falta alg√∫n dato)\ndf_ramadas &lt;- list(ram_pp, ram_tmax, ram_tmin) %&gt;%\n  reduce(full_join, by = c(\"agno\", \"mes\")) %&gt;%\n  mutate(estacion = \"Las Ramadas\")\n\n# --- PROCESAMIENTO COGOT√ç ---\ncog_pp   &lt;- leer_variable(ruta_cog_pp, \"pmen\")\ncog_tmax &lt;- leer_variable(ruta_cog_tmax, \"tmax\")\ncog_tmin &lt;- leer_variable(ruta_cog_tmin, \"tmin\")\n\ndf_cogoti &lt;- list(cog_pp, cog_tmax, cog_tmin) %&gt;%\n  reduce(full_join, by = c(\"agno\", \"mes\")) %&gt;%\n  mutate(estacion = \"Cogot√≠\")\n\n# - --- UNIFICACI√ìN Y C√ÅLCULOS ---\ndatos &lt;- bind_rows(df_ramadas, df_cogoti) %&gt;%\n  mutate(fecha = make_date(agno, mes, 1)) %&gt;%\n  # --- CORRECCI√ìN CLAVE AQU√ç ---\n  # Eliminamos filas sin temperatura ANTES de calcular hargreaves\n  drop_na(tmax, tmin) %&gt;%\n  mutate(\n    # Ahora s√≠ podemos calcular ETP sin errores\n    etp = hargreaves(tmin, tmax, lat = -31.0358),\n    bal = pmen - etp\n  ) %&gt;%\n  # Limpiamos si falta precipitaci√≥n o balance final\n  drop_na(bal) %&gt;%\n  arrange(estacion, fecha)\n\n\n[1] \"Calculating reference evapotranspiration using the Hargreaves method. Using latitude (`lat`) to estimate extraterrestrial radiation. Checking for missing values (`NA`): all the data must be complete. Input type is vector. Assuming the data are monthly time series starting in January, all regular (non-leap) years.\"\n\n\nC√≥digo\n# Guardar CSV procesado completo\nwrite_csv(datos, path(dir_data_proc, \"datos_procesados_unificados.csv\"))\n\n# --- C√ÅLCULO DE SPEI ---\ndatos_spei &lt;- datos %&gt;%\n  group_by(estacion) %&gt;%\n  nest() %&gt;%\n  mutate(\n    spei_12 = map(data, ~ as.numeric(spei(.x$bal, 12)$fitted)),\n    spei_03 = map(data, ~ as.numeric(spei(.x$bal, 3)$fitted))\n  ) %&gt;%\n  unnest(cols = c(data, spei_12, spei_03)) %&gt;% \n  ungroup()\n\n\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 12. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 12. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 3. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n[1] \"Calculating the Standardized Precipitation Evapotranspiration Index (SPEI) at a time scale of 3. Using kernel type 'rectangular', with 0 shift. Fitting the data to a log-Logistic distribution. Using the ub-pwm parameter fitting method. Checking for missing values (`NA`): all the data must be complete. Using the whole time series as reference period. Input type is vector. No time information provided, assuming a monthly time series.\"\n\n\nC√≥digo\n# Mostrar un resumen\nglimpse(datos_spei)\n\n\nRows: 1,165\nColumns: 11\n$ estacion &lt;chr&gt; \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"Cogot√≠\", \"‚Ä¶\n$ agno     &lt;dbl&gt; 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1965, 1‚Ä¶\n$ mes      &lt;dbl&gt; 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, 7, 8, 9‚Ä¶\n$ pmen     &lt;dbl&gt; 0.0, 0.0, 2.0, 38.0, 2.4, 153.5, 161.5, 0.0, 0.0, 1.2, 0.0, 0‚Ä¶\n$ tmax     &lt;dbl&gt; 28.9, 25.9, 23.3, 21.4, 21.9, 17.0, 16.0, 19.4, 22.8, 24.6, 2‚Ä¶\n$ tmin     &lt;dbl&gt; 16.3, 13.7, 11.3, 8.4, 8.4, 5.8, 6.0, 6.9, 9.4, 11.3, 14.0, 1‚Ä¶\n$ fecha    &lt;date&gt; 1965-02-01, 1965-03-01, 1965-04-01, 1965-05-01, 1965-06-01, ‚Ä¶\n$ etp      &lt;dbl&gt; 169.68881, 168.07156, 152.84507, 122.46746, 119.65757, 73.512‚Ä¶\n$ bal      &lt;dbl&gt; -169.68881, -168.07156, -150.84507, -84.46746, -117.25757, 79‚Ä¶\n$ spei_12  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 1.3954235, 1.3959‚Ä¶\n$ spei_03  &lt;dbl&gt; NA, NA, -0.07306118, 0.24514050, -0.38907950, 0.88506499, 1.5‚Ä¶\n\n\n\nVisualizaci√≥n: Precipitaci√≥n Mensual\n\nAn√°lisis de la distribuci√≥n de lluvias para la estaci√≥n Las Ramadas (1970-2015).\n\n\nC√≥digo\n# Filtrar datos (Rango ajustado 1970-2015)\ndf_box &lt;- datos_spei %&gt;% \n  filter(estacion == \"Las Ramadas\", year(fecha) &gt;= 1970 & year(fecha) &lt;= 2015)\n\n# Calcular colores\nmedianas &lt;- tapply(df_box$pmen, df_box$mes, median, na.rm=TRUE)\npaleta   &lt;- colorRampPalette(c(\"#E0F3DB\", \"#084081\"))(100)\ncolores  &lt;- paleta[findInterval(medianas, seq(min(medianas), max(medianas), length.out = 100))]\nmeses_esp &lt;- c(\"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\", \"Jul\", \"Ago\", \"Sep\", \"Oct\", \"Nov\", \"Dic\")\n\n# Funci√≥n de ploteo\nplot_boxplot &lt;- function() {\n  par(mar = c(4, 5, 3, 1))\n  boxplot(pmen ~ factor(mes, levels=1:12, labels = meses_esp), data = df_box,\n          col = colores, outline = FALSE, main = \"Pp Mensual Ramadas (1970-2015)\",\n          ylab = \"Pp (mm)\", las = 1, varwidth = TRUE)\n  grid(nx = NA, ny = NULL, lty = 3)\n  legend(\"topright\", legend=c(\"H√∫medo\",\"Seco\"), fill=c(paleta[100], paleta[1]), bty=\"n\", cex=0.8)\n}\n\nplot_boxplot()\n\n# Guardar PNG\npng(path(dir_figuras, \"boxplot_ramadas.png\"), width = 800, height = 500)\nplot_boxplot()\ndev.off()\n\n\nquartz_off_screen \n                2 \n\n\n\n\n\n\n\n\nFigura¬†1: Distribuci√≥n de precipitaci√≥n mensual en Las Ramadas (1970-2015)\n\n\n\n\n\n\nVisualizaci√≥n: √çndice SPEI\n\nEvoluci√≥n hist√≥rica de las sequ√≠as (SPEI-12 y SPEI-3).\n\n\nC√≥digo\n# Filtrar datos para gr√°fico\ndatos_grafico &lt;- datos_spei %&gt;% \n  filter(year(fecha) &gt;= 1970 & year(fecha) &lt;= 2015)\n\n# Funci√≥n para gr√°ficos\nplot_spei &lt;- function(df, var_spei, titulo) {\n  ggplot(df, aes(x = fecha, y = .data[[var_spei]])) +\n    geom_hline(yintercept = 0, color = \"grey40\", linewidth = 0.4) +\n    geom_col(aes(fill = .data[[var_spei]] &gt;= 0), width = 30) +\n    facet_wrap(~ estacion, ncol = 1, scales = \"free_x\") +\n    scale_fill_manual(values = c(\"TRUE\" = \"#6a994e\", \"FALSE\" = \"darkred\"), guide = \"none\") +\n    labs(title = titulo, x = \"A√±o\", y = \"SPEI\") +\n    theme_minimal(base_size = 13) +\n    theme(plot.title = element_text(hjust = 0.5, face = \"bold\"), \n          strip.text = element_text(face=\"bold\"))\n}\n\ng12 &lt;- plot_spei(datos_grafico, \"spei_12\", \"SPEI 12 Meses (1970-2015)\")\ng03 &lt;- plot_spei(datos_grafico, \"spei_03\", \"SPEI 3 Meses (1970-2015)\")\n\nprint(g12)\nprint(g03)\n\nggsave(path(dir_figuras, \"spei_12.png\"), g12, width = 10, height = 6, dpi = 300)\nggsave(path(dir_figuras, \"spei_03.png\"), g03, width = 10, height = 6, dpi = 300)\n\n\n\n\n\n\n\n\nFigura¬†2: Evoluci√≥n del √≠ndice SPEI a 12 y 3 meses\n\n\n\n\n\n\n\n\n\n\n\nFigura¬†3: Evoluci√≥n del √≠ndice SPEI a 12 y 3 meses"
  },
  {
    "objectID": "spei.html#visualizaci√≥n-de-precipitaci√≥n-mensual",
    "href": "spei.html#visualizaci√≥n-de-precipitaci√≥n-mensual",
    "title": "An√°lisis de Precipitaci√≥n y SPEI",
    "section": "3. Visualizaci√≥n de precipitaci√≥n mensual",
    "text": "3. Visualizaci√≥n de precipitaci√≥n mensual\nAn√°lisis de la distribuci√≥n de lluvias para la estaci√≥n Las Ramadas (1970-2015).\n\n\nC√≥digo\n# 1. Identificar estaciones √∫nicas\nestaciones_lista &lt;- unique(datos_spei$estacion)\n\n# 2. Definir funci√≥n para graficar y guardar\ngenerar_boxplot &lt;- function(nombre_estacion) {\n  \n  # Filtrar datos por estaci√≥n y fecha\n  df_box &lt;- datos_spei %&gt;% \n    filter(estacion == nombre_estacion, year(fecha) &gt;= 1970 & year(fecha) &lt;= 2015)\n  \n  # Calcular estad√≠sticas para colores\n  medianas &lt;- tapply(df_box$pmen, df_box$mes, median, na.rm=TRUE)\n  paleta   &lt;- colorRampPalette(c(\"#E0F3DB\", \"#084081\"))(100)\n  \n  # Evitar error si todos los valores son iguales\n  if(min(medianas) == max(medianas)) {\n    colores &lt;- rep(paleta[1], 12)\n  } else {\n    colores &lt;- paleta[findInterval(medianas, seq(min(medianas), max(medianas), length.out = 100))]\n  }\n  \n  meses_esp &lt;- c(\"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\", \"Jul\", \"Ago\", \"Sep\", \"Oct\", \"Nov\", \"Dic\")\n  \n  # Funci√≥n interna de dibujo (Estilo ORIGINAL)\n  dibujar &lt;- function() {\n    par(mar = c(4, 5, 3, 1))\n    \n    # Boxplot est√°ndar (sin eje manual)\n    boxplot(pmen ~ factor(mes, levels=1:12, labels = meses_esp), data = df_box,\n            col = colores, outline = FALSE, \n            main = paste(\"Precipitaci√≥n Mensual en\", nombre_estacion, \"(1970-2015)\"),\n            ylab = \"Precipitaci√≥n acumulada (mm)\", \n            xlab = \"\", # Dejamos esto vac√≠o para que no salga el texto t√©cnico \"factor(mes...)\"\n            las = 1, varwidth = TRUE)\n            \n    grid(nx = NA, ny = NULL, lty = 3)\n    legend(\"topright\", legend=c(\"Alta precipitaci√≥n\",\"Baja precipitaci√≥n\"), fill=c(paleta[100], paleta[1]), bty=\"n\", cex=0.8)\n  }\n  \n  # A. Mostrar en el documento HTML\n  dibujar()\n  \n  # B. Guardar como PNG\n  # Limpiar nombre (Ej: \"Las Ramadas\" -&gt; \"las_ramadas\")\n  nombre_limpio &lt;- tolower(gsub(\" \", \"_\", nombre_estacion)) \n  # Eliminar acentos para el nombre del archivo (opcional, pero recomendado)\n  nombre_limpio &lt;- iconv(nombre_limpio, to=\"ASCII//TRANSLIT\")\n  \n  nombre_archivo &lt;- paste0(\"boxplot_\", nombre_limpio, \".png\")\n  \n  png(path(dir_figuras, nombre_archivo), width = 800, height = 500)\n  dibujar()\n  dev.off()\n}\n\n# 3. Iterar la funci√≥n sobre cada estaci√≥n usando purrr::walk\nwalk(estaciones_lista, generar_boxplot)\n\n\n\n\n\n\n\n\nFigura¬†1: Distribuci√≥n de precipitaci√≥n mensual (1970-2015)\n\n\n\n\n\n\n\n\n\n\n\nFigura¬†2: Distribuci√≥n de precipitaci√≥n mensual (1970-2015)"
  },
  {
    "objectID": "spei.html#valores-del-spei",
    "href": "spei.html#valores-del-spei",
    "title": "An√°lisis de Precipitaci√≥n y SPEI",
    "section": "4. Valores del SPEI",
    "text": "4. Valores del SPEI\nPara interpretar los resultados, utilizaremos la siguiente escala de referencia:\n\n\nC√≥digo\n#| label: tabla-referencia-spei\n#| echo: false\n\n# Crear la tabla de datos\ntabla_spei &lt;- tibble::tribble(\n  ~\"Categor√≠a de humedad\",   ~\"Rango SPEI\",\n  \"Extremadamente h√∫medo\",   \"‚â• 2.00\",\n  \"Muy h√∫medo\",              \"1.50 a 1.99\",\n  \"Moderadamente h√∫medo\",    \"1.00 a 1.49\",\n  \"Valores normales\",        \"-0.99 a 0.99\",\n  \"Moderadamente seco\",      \"-1.00 a -1.49\",\n  \"Severamente seco\",        \"-1.50 a -1.99\",\n  \"Extremadamente seco\",     \"‚â§ -2.00\"\n)\n\n# Imprimir la tabla con formato simple\nknitr::kable(\n  tabla_spei, \n  caption = \"Tabla 1. Categor√≠as de clasificaci√≥n de humedad seg√∫n √≠ndice SPEI.\",\n  align = c(\"l\", \"c\")\n)\n\n\n\nTabla 1. Categor√≠as de clasificaci√≥n de humedad seg√∫n √≠ndice SPEI.\n\n\nCategor√≠a de humedad\nRango SPEI\n\n\n\n\nExtremadamente h√∫medo\n‚â• 2.00\n\n\nMuy h√∫medo\n1.50 a 1.99\n\n\nModeradamente h√∫medo\n1.00 a 1.49\n\n\nValores normales\n-0.99 a 0.99\n\n\nModeradamente seco\n-1.00 a -1.49\n\n\nSeveramente seco\n-1.50 a -1.99\n\n\nExtremadamente seco\n‚â§ -2.00"
  }
]